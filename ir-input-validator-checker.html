<dom-module is="ir-input-validator-checker">
	<template>

		<span id="invalidForm" hidden="{{ !showContent }}">
			<content></content>
		</span>

	</template>
</dom-module>

<style>
	#invalidForm{
		color: darkred;
		margin-top : 12px;
	}

</style>

<script>
if(!window.ir) window.ir = {};

Polymer({
	is : "ir-input-validator-checker",
	attached : function() {

		var that = this, validators, form;

		form = this;
		while(form.tagName != 'FORM')
			form = form.parentNode;

		if(!form)
			return console.warn("ir-input-validator-checker couldn't find an ancestor form and will do nothing: ", this);

		validators = [].slice.call(Polymer.dom(form).querySelectorAll('ir-input-validator'));
		this.set("validators", validators);
		
		form.addEventListener('check-form', this.digestValidators.bind(this));
		
		//validators.forEach(function(v) { ); }.bind(this));
	},
	
	digestValidators : function() {
		var digest = this.validators.reduce(function(r, v) { 
			return r + (v.forceValidate(true) ? 0 : 1) 
		}, 0);
		this.set('isValid', !digest);
		this.set('errorsCount', digest);
	},
	
	validate : function() {
		this.digestValidators();
		return this.isValid;
	},
	
	_showContent : function() {
		return !this.isValid;
	},

	properties : {
		isValid : { type : Boolean, value : true },
		validators : { type : Object },
		errorsCount : { type:Number, value : 0},
		showContent : { type: Boolean, computed : "_showContent(isValid)" }
	}
});
</script>
